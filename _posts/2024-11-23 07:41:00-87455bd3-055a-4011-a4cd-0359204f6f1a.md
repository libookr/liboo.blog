---
layout: post
current: post
cover: 'assets/images/piano.jpg'
navigation: true
title: "87455bd3-055a-4011-a4cd-0359204f6f1a"
date: 2024-11-23 07:41:00
tags:
    - 
class: post-template
subclass: 'post'
author: "김준서"
categories:
    - 
---
<br><br>

## 🚨 문제 상황


클라이언트에서 이미지를 전송 할 때 작은 용량의 이미지들은 그냥 base64로 인코딩해서 전송하기로 계획하였습니다.


그러나 HTTP Payload의 Body를 통해 전달되는 데이터인 만큼 송수신 과정에 큰 문제가 없을 것이라 생각했지만, 막상 데이터를 전달해보니 413 (Request Entity Too Large) 오류를 맞닥뜨리게 되었습니다.


## 🏃 해결 과정


### 1. Nginx의 전송 데이터 크기 증가


처음 시도한 방법은 Nginx에서 http로 전달되는 데이터의 최대 크기를 키워주는 방법이었습니다.


413 에러 관련 검색을 진행하였을 때 제일 먼저 나왔던 방법으로 다음과 같이 Nginx의 허용 데이터 크기를 확장시키는 방법이었습니다.



```
javascript
http {
    ...
    client_max_body_size 20m;
    ...
} 

```



이처럼 http 서비스를 가정할 때 client_max_body_size를 조정해줌으로써 Nginx를 거쳐서 오는 데이터의 크기를 확장할 수 있었습니다.


저희 서비스에서는 Nginx가 앞 단에서 프록시 서버의 역할을 하고 있었기에 Nginx Config를 수정하는 방법을 적용해보았지만, 아쉽게도 해결되지 않았습니다.


### 2. NestJS에서 전송 데이터 크기 증가


다음으로 시도한 방법은 NestJS에서 전달 받는 HTTP Json Payload의 크기를 키우는 방법이 있었습니다.


main 실행 코드에 아래의 코드를 추가하면 Http를 통해 전달 받는 Payload의 Json 데이터의 크기를 조절할 수 있습니다.



```
javascript
import { json } from 'body-parser';

app.use(json({ limit: '50mb' }));

```



다행히 위의 코드를 적용하여 문제를 해결할 수 있었습니다.


## ✅ 문제 해결


> 참고자료  
> [https://www.zerocho.com/category/HTTP/post/6507ad4a457fe081afb2a769](https://www.zerocho.com/category/HTTP/post/6507ad4a457fe081afb2a769)  
> [https://codegear.tistory.com/120](https://codegear.tistory.com/120)  
> 

