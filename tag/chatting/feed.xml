<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator>
  <link href="https://blog.liboo.kr/tag/chatting/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://blog.liboo.kr/" rel="alternate" type="text/html" />
  <updated>2025-01-22T12:09:25+00:00</updated>
  <id>https://blog.liboo.kr/tag/chatting/feed.xml</id>

  
  
  

  
    <title type="html">Liboo.blog | </title>
  

  
    <subtitle>ë¼ì´ë¶€ ê°œë°œ ë¸”ë¡œê·¸</subtitle>
  

  

  
    
      
    
      
    
      
    
      
    
      
    
  

  
  

  
    <entry>
      <title type="html">[ì±„íŒ… ì„œë²„] ì±„íŒ… ì„œë²„ ê°œì„ ê¸° ê¸°ë¡</title>
      <link href="https://blog.liboo.kr/%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84-_%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84_%EA%B0%9C%EC%84%A0%EA%B8%B0_%EA%B8%B0%EB%A1%9D" rel="alternate" type="text/html" title="[ì±„íŒ… ì„œë²„] ì±„íŒ… ì„œë²„ ê°œì„ ê¸° ê¸°ë¡" />
      <published>2024-11-23T04:14:00+00:00</published>
      <updated>2024-11-23T04:14:00+00:00</updated>
      <id>https://blog.liboo.kr/%5B%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84%5D_%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84_%EA%B0%9C%EC%84%A0%EA%B8%B0_%EA%B8%B0%EB%A1%9D</id>
      <content type="html" xml:base="https://blog.liboo.kr/%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84-_%EC%B1%84%ED%8C%85_%EC%84%9C%EB%B2%84_%EA%B0%9C%EC%84%A0%EA%B8%B0_%EA%B8%B0%EB%A1%9D">&lt;h1 id=&quot;redis-adapter-ê°€-ëª¨ë“ -ë ˆë””ìŠ¤-ë…¸ë“œì—-broadcast-í•˜ëŠ”-ë¬¸ì œ&quot;&gt;Redis Adapter ê°€ ëª¨ë“  ë ˆë””ìŠ¤ ë…¸ë“œì— Broadcast í•˜ëŠ” ë¬¸ì œ&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/upload/2024-11-23-[ì±„íŒ…_ì„œë²„]_ì±„íŒ…_ì„œë²„_ê°œì„ ê¸°_ê¸°ë¡.md/0.png&quot; alt=&quot;0&quot; /&gt;&lt;em&gt;image.png&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ë ˆë””ìŠ¤ ì–´ëŒ‘í„°ì™€ ë ˆë””ìŠ¤ë¥¼ í™œìš©í•˜ë©´ ìœ„ì™€ ê°™ì´ ë ˆë””ìŠ¤ pub sub ì„ í†µí•´ì„œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ê²Œ ë˜ëŠ”ë°, ë¬¸ì œëŠ” ì—¬ê¸°ì„œ redis-cluster ë¥¼ í™œìš©í•˜ê²Œ ë˜ë©´ ì´ë²¤íŠ¸ ì „ë‹¬ì„ ì–´ë””ì— í•´ì•¼í• ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ëª¨ë“  ë ˆë””ìŠ¤ ë…¸ë“œì—ë‹¤ê°€ ì „íŒŒí•˜ê²Œ ëœë‹¤.&lt;/p&gt;

&lt;p&gt;Redis Node A, B, C, D â€¦. Z ê¹Œì§€ ìˆì„ ë•Œ, A ì—ë§Œ ì „ë‹¬í•˜ë©´ ë˜ëŠ” ì´ë²¤íŠ¸ë¥¼ A~Z ê¹Œì§€ ëª¨ë‘ ì „íŒŒí•˜ê²Œ ëœë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ShardedAdapter&lt;a href=&quot;https://redis.io/docs/latest/develop/interact/pubsub/#sharded-pubsub&quot;&gt;https://redis.io/docs/latest/develop/interact/pubsub/#sharded-pubsub&lt;/a&gt; ë¥¼ í™œìš©í•´ì•¼ í•˜ëŠ”ë°, SharedAdapter ëŠ” í•´ì‹œí•¨ìˆ˜ë¥¼ í™œìš©í•´ì„œ ë°ì´í„°ë¥¼ ì–´ë–¤ ë…¸ë“œì— ì €ì¥í•´ì•¼í• ì§€ ì•Œê³  ìˆë‹¤. ë”°ë¼ì„œ â€˜room123â€™ ìœ¼ë¡œ ë©”ì„¸ì§€ê°€ ë“¤ì–´ì˜¨ë‹¤ë©´ room123 ì˜ í•´ì‹œê°’ì„ ê³„ì‚°í•´ì„œ í•´ë‹¹ ë ˆë””ìŠ¤ ìƒ¤ë“œêµ°ì—ë§Œ ì „íŒŒí•œë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ë˜ì„œ ioredis + sharded adapter ë¥¼ í™œìš©í•˜ë ¤ê³  ë³´ë‹ˆê¹Œâ€¦.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/upload/2024-11-23-[ì±„íŒ…_ì„œë²„]_ì±„íŒ…_ì„œë²„_ê°œì„ ê¸°_ê¸°ë¡.md/1.png&quot; alt=&quot;1&quot; /&gt;&lt;em&gt;image.png&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ê³µì‹ë¬¸ì„œ (&lt;a href=&quot;https://socket.io/docs/v4/redis-adapter/#with-redis-sharded-pubsub&quot;&gt;https://socket.io/docs/v4/redis-adapter/#with-redis-sharded-pubsub&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;í˜„ì¬ ioredis ì™€ redis cluster ë¥¼ í™œìš©í•œ sharded adapter ëŠ” ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤.&lt;/p&gt;

&lt;p&gt;ì‹¤ì œë¡œ sharded adapter ë¥¼ ì–µì§€ë¡œ ì‚¬ìš©í•´ë³´ë ¤ê³  í•˜ë‹ˆ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;[**Too many cluster redirections during Redis cluster reshard**](https://stackoverflow.com/questions/46472130/too-many-cluster-redirections-during-redis-cluster-reshard)&lt;/code&gt; ë¼ëŠ” ì˜¤ë¥˜ê°€ ë‚œë‹¤.&lt;/p&gt;

&lt;p&gt;shardedAdapter ëŠ” ê¸°ì¡´ì˜ subscribe ì»¤ë§¨ë“œê°€ ì•„ë‹Œ, (SSUBSCRIBE, SPUBLISH, SUNSUBCRIBE) ê°™ì€ ì»¤ë§¨ë“œë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ioredis ì—ì„œ í•´ë‹¹ ì»¤ë§¨ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸.&lt;/p&gt;

&lt;p&gt;í•´ê²°ì±…ìœ¼ë¡œëŠ”&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ioredis ë¥¼ node-redis ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ + shardedAdapter ì‚¬ìš©&lt;/li&gt;
  &lt;li&gt;redis cluster ë¥¼ ë²„ë¦¬ê³  &lt;a href=&quot;http://nats.io/&quot;&gt;Nats.io&lt;/a&gt; ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜&lt;/li&gt;
  &lt;li&gt;íŒŒí‹°ì…”ë‹ì„ í†µí•´ì„œ ëª¨ë“  redis ë¥¼ redis cluster ë¡œ ë¬¶ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì‹¤ì œë¡œ í•„ìš”í•œ redis ì—ë§Œ publish ë˜ë„ë¡ í•˜ê¸°&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;ioredis-ë¥¼-node-redis-ë¡œ-ë§ˆì´ê·¸ë ˆì´ì…˜--shardedadapter-ì‚¬ìš©&quot;&gt;ioredis ë¥¼ node-redis ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ + shardedAdapter ì‚¬ìš©&lt;/h2&gt;

&lt;p&gt;ìš°ì„  1ë²ˆì˜ ê²½ìš° ioredis ë¥¼ ì‚¬ìš©í•˜ë˜ ë¶€ë¶„ì„ ì „ë¶€ node-redis ë¡œ ë°”ê¾¸ì–´ì•¼í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. í•˜ì§€ë§Œ í˜„ì¬ ioredis ë¼ì´ë¸ŒëŸ¬ë¦¬ ìƒíƒœë¥¼ ë´¤ì„ ë•Œ ì¶”ê°€ì ì¸ ì—…ë°ì´íŠ¸ë„ ì—†ê³  node-redis ì˜ ê²½ìš°ì—ëŠ” sharded adapter ë„ ì—…ë°ì´íŠ¸ë¥¼ í•´ë†“ì€ê±¸ ë³´ë©´ ë°”ê¾¸ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ë‹¤ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;redis-cluster-ë¥¼-ë²„ë¦¬ê³ -natsio-ë¡œ-ë§ˆì´ê·¸ë ˆì´ì…˜&quot;&gt;redis cluster ë¥¼ ë²„ë¦¬ê³  &lt;a href=&quot;http://nats.io/&quot;&gt;Nats.io&lt;/a&gt; ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜&lt;/h2&gt;

&lt;p&gt;2ë²ˆì˜ ê²½ìš°ì—ëŠ”&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://channel.io/ko/blog/articles/228efe0c&quot;&gt;https://channel.io/ko/blog/articles/228efe0c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ì±„ë„í†¡ì˜ ë¸”ë¡œê·¸ì—ì„œ ì•„ì£¼ ì˜ ì„¤ëª…í•´ì£¼ê³  ìˆë‹¤. &lt;a href=&quot;http://nats.io/&quot;&gt;Nats.io&lt;/a&gt; ì€ ì™„ì „ ë©”ì‹œ í˜•íƒœë¡œ, ì²˜ë¦¬ëŸ‰ì€ redis ì— ë¹„í•´ ì›”ë“±íˆ ì¢‹ì€ ìˆ˜ì¤€ì„ ë³´ì´ì§€ë§Œ subject ê°€ ìƒê¸¸ ë•Œ ëª¨ë“  &lt;a href=&quot;http://nats.io/&quot;&gt;nats.io&lt;/a&gt; ì˜ ì¸ìŠ¤í„´ìŠ¤ì— pubsub ì„ ì „íŒŒí•´ì£¼ì–´ì•¼í•˜ëŠ”ë° ì´ ë¶€ë¶„ì—ì„œ ì˜¤ë²„í—¤ë“œê°€ ìƒë‹¹íˆ í¬ê²Œ ì‘ìš©í•œë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;íŒŒí‹°ì…”ë‹ì„-í†µí•´ì„œ-ëª¨ë“ -redis-ë¥¼-redis-cluster-ë¡œ-ë¬¶ëŠ”-ê²ƒì´-ì•„ë‹ˆë¼-ì‹¤ì œë¡œ-í•„ìš”í•œ-redis-ì—ë§Œ-publish-ë˜ë„ë¡-í•˜ê¸°&quot;&gt;íŒŒí‹°ì…”ë‹ì„ í†µí•´ì„œ ëª¨ë“  redis ë¥¼ redis cluster ë¡œ ë¬¶ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì‹¤ì œë¡œ í•„ìš”í•œ redis ì—ë§Œ publish ë˜ë„ë¡ í•˜ê¸°&lt;/h2&gt;

&lt;p&gt;3ë²ˆì˜ ê²½ìš°ë„ ì±„ë„í†¡ì—ì„œ ì´ë¯¸ ì§„í–‰í–ˆë˜ ë°©ì‹ì¸ë°,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://channel.io/ko/blog/articles/4ab1f0c2&quot;&gt;https://channel.io/ko/blog/articles/4ab1f0c2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ë ˆë””ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ë¬¸ì œì ì´ ì—°ê´€ì—†ëŠ”(êµ³ì´ publish ì•ˆë³´ë‚´ë„ ë˜ëŠ”) ë…¸ë“œì— publish ë¥¼ ë³´ë‚¸ë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë ˆë””ìŠ¤ì™€ ì±„íŒ…ì„œë²„ë¥¼ í•˜ë‚˜ì˜ cluster ë¡œ ë¬¶ê³ , ì´ í´ëŸ¬ìŠ¤í„° ë‹¨ìœ„ë¡œ ë„ì»¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ì„œë¹„ìŠ¤&lt;/code&gt;ë¥¼ ìƒì„±í•œë‹¤. í•˜ë‚˜ì˜ ê±°ëŒ€í•œ ì§‘í•©ì´ì—ˆë˜ ì±„íŒ…ì„œë²„ + Redis Cluster ë¥¼ ì¡°ê¸ˆ ë” ì‘ì€ ì—¬ëŸ¬ê°œì˜ ë…¼ë¦¬ì  êµ¬ì¡°ë¡œ ìª¼ê°œë³´ëŠ” ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  room ID ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ ì„œë¹„ìŠ¤ì— ë¡œë“œë°¸ëŸ°ì‹± ë˜ë„ë¡ NGINX ë¥¼ ë§Œë“ ë‹¤.&lt;/p&gt;

&lt;p&gt;í•˜ì§€ë§Œ ì±„ë„í†¡ ì„œë¹„ìŠ¤ì™€ëŠ” ë‹¤ë¥´ê²Œ LiBoo ì„œë¹„ìŠ¤ì—ì„œëŠ” SharedWorker ë¥¼ í™œìš©í•´ì„œ í´ë¼ì´ì–¸íŠ¸ëŠ” 1ê°œì˜ ì†Œì¼“ë§Œ ìƒì„±í•˜ê²Œ ëœë‹¤. í•˜ë‚˜ì˜ ì†Œì¼“ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ room ì— join í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì¸ë°, 3ë²ˆì²˜ëŸ¼ íŒŒí‹°ì…”ë‹ì„ í•˜ê²Œ ë  ê²½ìš° ì†Œì¼“ì„ 1ê°œë¡œ ë§Œë“  ì´ìœ ê°€ ì‚¬ë¼ì§€ê²Œ ëœë‹¤.&lt;/p&gt;

&lt;p&gt;A ë¼ëŠ” ì±„íŒ…ì„œë²„ì— WebSocket ì—°ê²°ì„ ë§ºì—ˆëŠ”ë° , ì±„íŒ… ì„œë²„ B ì— ìˆëŠ” room ì— ì ‘ê·¼í•˜ë ¤ë©´ ìƒˆë¡œìš´ ì†Œì¼“ì„ ìƒì„±í•´ì„œ ì±„íŒ… ì„œë²„ B ì— ì—°ê²°í•´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤.&lt;/p&gt;

&lt;p&gt;ê·¸ë‚˜ë§ˆ íŒŒí‹°ì…”ë‹ì„ í•˜ë ¤ë©´ ë ˆë””ìŠ¤ í´ëŸ¬ìŠ¤í„°ë§Œ íŒŒí‹°ì…”ë‹ì„ í•˜ë©´ ê´œì°®ì„ ê²ƒ ê°™ì€ë°,&lt;/p&gt;

&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´ Redis cluster ì— 9ê°œì˜ ë§ˆìŠ¤í„°ê°€ ìˆì—ˆë‹¤ê³  í•˜ë©´, 3 / 3 / 3 ê°œë¡œ íŒŒí‹°ì…”ë‹ì„ í•˜ê³  ì±„íŒ…ì„œë²„ë§ˆë‹¤ 3ê°œì˜ ë ˆë””ìŠ¤ connection ì„ ìœ ì§€í•˜ëŠ” ë°©ì‹ì¼ ê²ƒì´ë‹¤.&lt;/p&gt;

&lt;p&gt;ì´ ë°©ë²•ì€ publish ê°€ 9ë²ˆ ë  ê²ƒì´ 3ë²ˆì´ ëœë‹¤ëŠ” ì¥ì ì´ ìˆê² ìœ¼ë‚˜ ë ˆë””ìŠ¤ ì»¤ë„¥ì…˜ì„ 1ê°œ â†’ 3ê°œë¥¼ ìœ ì§€í•´ì•¼í•œë‹¤ëŠ” ë‹¨ì ì´ ìƒê¸´ë‹¤. ë”°ë¼ì„œ ì„±ëŠ¥ ê°œì„ ì´ ìˆì„ì§€ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì§ì ‘ í•´ë´ì•¼ ì•Œ ê²ƒ ê°™ë‹¤.&lt;/p&gt;

&lt;h2 id=&quot;ë²ˆì™¸&quot;&gt;ë²ˆì™¸&lt;/h2&gt;

&lt;p&gt;ì±„ë„í†¡ ì„œë¹„ìŠ¤ì²˜ëŸ¼ ë§Œì•½ ìš°ë¦¬ ì„œë¹„ìŠ¤ë„ 1ê°œì˜ ì†Œì¼“ì´ 1ê°œì˜ room ì—ë§Œ join ë˜ëŠ” ê²ƒ ì²˜ëŸ¼, ì™„ë²½í•˜ê²Œ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆì—ˆë‹¤ë©´ ì–´ë• ì„ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ë‹¤.&lt;/p&gt;

&lt;p&gt;í…ŒìŠ¤íŠ¸ í™˜ê²½ì€ macos ì—ì„œ ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ í™œìš©í–ˆë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;ê¸°ì¡´-í™˜ê²½&quot;&gt;ê¸°ì¡´ í™˜ê²½&lt;/h3&gt;

&lt;p&gt;ê¸°ì¡´ì˜ í™˜ê²½ì€ ì±„íŒ…ì„œë²„ 3ëŒ€ë¥¼ ì»¨í…Œì´ë„ˆë¡œ, 6ëŒ€ì˜ ë ˆë””ìŠ¤ ë…¸ë“œë¥¼ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¡œ ë§Œë“  ë ˆë””ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì—ˆë‹¤. ëª¨ë‘ ê°ê°ì˜ docker bridge ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•˜ê³  ìˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì•„ë˜ëŠ” pubsub cluster ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©í•œ docker-compose.yaml ê³¼ config íŒŒì¼ì´ë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yaml
version: &quot;3&quot;
services:
  redis-pubsub-master-1:
    platform: linux/x86_64 # m1 MacOSì˜ ê²½ìš°
    image: redis:6.2
    container_name: redis-pubsub-m1
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.2
    volumes: # ì‘ì„±í•œ ì„¤ì • íŒŒì¼ì„ ë³¼ë¥¨ì„ í†µí•´ ì»¨í…Œì´ë„ˆì— ê³µìœ 
      - ./redis-pubsub-master-7001.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7001:7001
  redis-pubsub-master-2:
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.3
    platform: linux/x86_64
    image: redis:6.2
    container_name: redis-pubsub-m2
    volumes:
      - ./redis-pubsub-master-7002.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7002:7002

  redis-pubsub-master-3:
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.4
    platform: linux/x86_64
    image: redis:6.2
    container_name: redis-pubsub-m3
    volumes:
      - ./redis-pubsub-master-7003.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7003:7003

  redis-pubsub-master-4:
    platform: linux/x86_64 # m1 MacOSì˜ ê²½ìš°
    image: redis:6.2
    container_name: redis-pubsub-m4
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.5
    volumes: # ì‘ì„±í•œ ì„¤ì • íŒŒì¼ì„ ë³¼ë¥¨ì„ í†µí•´ ì»¨í…Œì´ë„ˆì— ê³µìœ 
      - ./redis-pubsub-master-7004.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7004:7004
  redis-pubsub-master-5:
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.6
    platform: linux/x86_64
    image: redis:6.2
    container_name: redis-pubsub-m5
    volumes:
      - ./redis-pubsub-master-7005.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7005:7005

  redis-pubsub-master-6:
    networks:
      redis-pubsub-network:
        ipv4_address: 192.168.101.7
    platform: linux/x86_64
    image: redis:6.2
    container_name: redis-pubsub-m6
    volumes:
      - ./redis-pubsub-master-7006.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    ports:
      - 7006:7006

networks:
  redis-pubsub-network:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.101.0/24 # ì‚¬ìš©ì ì •ì˜ ì„œë¸Œë„·


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yaml
port 7001 
# port : 7001 ~ 7006
maxmemory 256mb
maxmemory-policy volatile-lru
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
bind 0.0.0.0


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;íŒŒí‹°ì…”ë‹-í™˜ê²½&quot;&gt;íŒŒí‹°ì…”ë‹ í™˜ê²½&lt;/h3&gt;

&lt;p&gt;íŒŒí‹°ì…”ë‹ í™˜ê²½ì€ ì±„íŒ… ì„œë²„ 3ëŒ€, ë ˆë””ìŠ¤ ë…¸ë“œ 1ëŒ€ë¥¼ ë¬¶ì–´ì„œ docker stack ìœ¼ë¡œ ë§Œë“¤ì—ˆê³  docker overlay ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•˜ê³  ìˆë‹¤.&lt;/p&gt;

&lt;p&gt;ì•„ë˜ëŠ” íŒŒí‹°ì…”ë‹ í™˜ê²½ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‘ì„±í•œ docker-compose.yaml ì´ë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;yaml
version: &apos;3.8&apos;

services:
  redis-master:
    image: redis:6.2
    command: [&quot;redis-server&quot;, &quot;/etc/redis/redis.conf&quot;]
    networks:
      - shared-network
    volumes:
      - ./redis/master.conf:/etc/redis/redis.conf
    deploy:
      replicas: 1

  chat-server:
    image: chattest:latest
    environment:
      LOCAL_REDIS_CONFIG: &apos;[{&quot;host&quot;:&quot;host.docker.internal&quot;,&quot;port&quot;:9001},{&quot;host&quot;:&quot;host.docker.internal&quot;,&quot;port&quot;:9002},{&quot;host&quot;:&quot;host.docker.internal&quot;,&quot;port&quot;:9003}]&apos;
      REDIS_PUBSUB_CONFIG: &apos;{&quot;host&quot;:&quot;redis-master&quot;,&quot;port&quot;:6379}&apos;
    networks:
      - shared-network
    deploy:
      replicas: 3  # 3ê°œì˜ ë³µì œë³¸ì„ ìƒì„±í•©ë‹ˆë‹¤.
      update_config:
        parallelism: 1  # í•œ ë²ˆì— í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆë§Œ ì—…ë°ì´íŠ¸í•˜ë„ë¡ ì„¤ì •

networks:
  shared-network:
    external: true
    driver: overlay


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;LOCAL_REDIS_CONFIG ëŠ” ìºì‹œìš© ë ˆë””ìŠ¤ì´ë¯€ë¡œ ì§€ê¸ˆ ì§„í–‰ì¤‘ì¸ í…ŒìŠ¤íŠ¸ë‘ì€ ë¬´ê´€í•˜ë‹¤.&lt;/p&gt;

&lt;h3 id=&quot;ê²°ê³¼&quot;&gt;ê²°ê³¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;ê¸°ì¡´ í™˜ê²½(ì±„íŒ…ì„œë²„ 3ëŒ€ì™€ redis cluster), íŒŒí‹°ì…”ë‹ X&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/upload/2024-11-23-[ì±„íŒ…_ì„œë²„]_ì±„íŒ…_ì„œë²„_ê°œì„ ê¸°_ê¸°ë¡.md/2.png&quot; alt=&quot;2&quot; /&gt;&lt;em&gt;image.png&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/upload/2024-11-23-[ì±„íŒ…_ì„œë²„]_ì±„íŒ…_ì„œë²„_ê°œì„ ê¸°_ê¸°ë¡.md/3.png&quot; alt=&quot;3&quot; /&gt;&lt;em&gt;image.png&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;(ê·¸ë˜í”„ì˜ 20:38 ~ 20:41)&lt;/p&gt;

&lt;p&gt;ì±„íŒ… ì„œë²„ì— 150ëª…ì˜ ìœ ì €ê°€ 3ë²ˆì˜ ì±„íŒ…(ì¼ë°˜ì±„íŒ… 2ë²ˆ + ì§ˆë¬¸ì±„íŒ… 1ë²ˆ, â€˜helloâ€™ ë¼ëŠ” ë‚´ìš©ìœ¼ë¡œ)ì„ ë³´ëƒˆì„ ë•Œ, ê°ê°ì˜ PubSub ì»¨í…Œì´ë„ˆëŠ” ì†¡ìˆ˜ì‹ ì— 5MB ì •ë„ì”©ì˜ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ë¥ ì„ ë³´ì˜€ë‹¤. (ì´ 30MB ì •ë„)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ì±„íŒ…ì„œë²„ 1ëŒ€ + ë ˆë””ìŠ¤ 1ëŒ€ë¡œ íŒŒí‹°ì…”ë‹í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/upload/2024-11-23-[ì±„íŒ…_ì„œë²„]_ì±„íŒ…_ì„œë²„_ê°œì„ ê¸°_ê¸°ë¡.md/4.png&quot; alt=&quot;4&quot; /&gt;&lt;em&gt;image.png&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;ì•„ë¬´ë˜ë„ ì´ë²¤íŠ¸ ìì²´ë¥¼ ë‹¤ë¥¸ ë ˆë””ìŠ¤ ë…¸ë“œì— publish í•˜ì§€ ì•Šë‹¤ë³´ë‹ˆ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ëŸ‰ì´ ë§ì´ ì¤„ì—ˆë‹¤.&lt;/p&gt;

&lt;p&gt;ë³´ë‚´ëŠ” ë°ì´í„°ê°€ 1.6MB, ë°›ëŠ” ë°ì´í„°ëŠ” 0.6MB ì •ë„ ë˜ëŠ” ê²ƒ ê°™ë‹¤.&lt;/p&gt;

&lt;p&gt;ë‹¤ë§Œ íŒŒí‹°ì…”ë‹ í™˜ê²½ì€ íŒŒí‹°ì…”ë‹ëœ êµ¬ì¡°ì— â€˜ê³¨ê³ ë£¨â€™ ë°ì´í„°ê°€ ë“¤ì–´ì˜¨ë‹¤ëŠ” ì „ì œë¡œ ì§„í–‰í–ˆë‹¤ë³´ë‹ˆ ë‹¹ì—°íˆ ì•ˆì •ì ìœ¼ë¡œ ë³´ì¸ë‹¤.&lt;/p&gt;

&lt;p&gt;ì•„ë¬´ë˜ë„ í•˜ë‚˜ì˜ (ì±„íŒ…ì„œë²„ + ë ˆë””ìŠ¤) ì— íŠ¸ë˜í”½ì´ ëª°ë¦°ë‹¤ë©´ ì´ êµ¬ì¡°ë„ ì¶”ê°€ í™•ì¥ì´ í•„ìš”í•´ë³´ì¸ë‹¤.&lt;/p&gt;

&lt;h1 id=&quot;default-room-ì„-ë‚˜ê°€ë©´-socketio-ì˜-broadcast-ë¡œì§ì´-ë°”ë€ŒëŠ”-ë¬¸ì œ&quot;&gt;Default Room ì„ ë‚˜ê°€ë©´ &lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ì˜ Broadcast ë¡œì§ì´ ë°”ë€ŒëŠ” ë¬¸ì œ&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ì˜ Default Room ì„ ë‚˜ê°€ë©´ Sender ë¥¼ í¬í•¨í•´ì„œ Broadcast ë˜ëŠ” í˜„ìƒ&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ëŠ” ì±„íŒ…ì„ í•˜ê¸° ìœ„í•´ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;room&lt;/code&gt; ì— join í•˜ê²Œ ë©ë‹ˆë‹¤. ê°™ì€ room ì— ìˆëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” ê°™ì€ ì±„íŒ…ë°©ì— ìˆëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ëŠ” ìœ ì €ì˜ ì†Œì¼“ ì—°ê²°ì„ í•  ë•Œ, &lt;a href=&quot;http://socket.id/&quot;&gt;socket.id&lt;/a&gt; ì™€ ë™ì¼í•œ ì´ë¦„ì˜ room (Default Room) ì— ìë™ìœ¼ë¡œ join í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŠ” 1:1 ì±„íŒ…ì´ë‚˜ ì„œë²„ì—ì„œ ê°œì¸ì—ê²Œ ê³µì§€ë¥¼ ë³´ë‚´ëŠ” ë“±ì˜ ìš©ë„ë¡œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ê·¸ëŸ¬ë‚˜ ì €í¬ ì„œë¹„ìŠ¤ëŠ” ìœ„ì™€ ê°™ì€ 1:1 ì±„íŒ…ì´ ì—†ëŠ” ì‹¤ì‹œê°„ ë¼ì´ë¸Œ ë°©ì†¡ì˜ ì±„íŒ…ì´ë¯€ë¡œ ì´ëŸ¬í•œ Default Room ì€ ì‚¬ìš©ë˜ì§€ ì•Šì€ ì±„ ì„œë²„ì˜ ë©”ëª¨ë¦¬ë¥¼ ë‚­ë¹„í•  ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;ë”°ë¼ì„œ ì†Œì¼“ ì—°ê²°ì„ í•  ë•Œ Default Room ì— join í•˜ì§€ ì•Šë„ë¡ ë¡œì§ì„ ìˆ˜ì •í–ˆëŠ”ë° ì—°ê´€ì´ ì—†ë‹¤ê³  ìƒê°í–ˆë˜ broadcast ë¡œì§ì´ ë°”ë€ŒëŠ” í˜„ìƒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.&lt;/li&gt;
  &lt;li&gt;broadcast ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ sender ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ì œì™¸&lt;/code&gt; í•˜ê³  ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ëŠ” ë¡œì§ì¸ë°, Default Room ì—ì„œ ë‚˜ê°„ ì±„ë¡œ broadcast ë¥¼ í•˜ê²Œ ë˜ë©´ Sender ë¥¼ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;í¬í•¨&lt;/code&gt;í•´ì„œ ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ëŠ” ë¡œì§ìœ¼ë¡œ ë°”ë€ŒëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (&lt;a href=&quot;https://github.com/socketio/socket.io/issues/4524&quot;&gt;ê´€ë ¨ ì´ìŠˆÂ ğŸ”—&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ 3ê°€ì§€ ì •ë„ì˜ ë°©ë²•ì„ ìƒê°í•´ë³´ì•˜ìŠµë‹ˆë‹¤.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- [socket.io](http://socket.io/) ëŒ€ì‹  WebSocket ì„ ì‚¬ìš©í•˜ë©´ì„œ room + broadcast ê°œë…ì„ ì§ì ‘ êµ¬í˜„
- [socket.io](http://socket.io/) ì˜ room ê°œë…ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•œ ì±„ë¡œ broadcast ë¡œì§ì„ ìƒˆë¡­ê²Œ êµ¬í˜„
- [socket.io](http://socket.io/) ì˜ broadcast ë¡œì§ì„ ì§ì ‘ ìˆ˜ì •

ì´ ì¤‘ì—ì„œ broadcast ë¡œì§ì„ ì§ì ‘ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ê·¼ë³¸ì ì¸ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì¢‹ì€ ë°©ë²•ì´ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì²« ë²ˆì§¸ë¡œ í”„ë¡œì íŠ¸ì—ì„œ Default Room ì„ ìˆ˜ì •í–ˆì„ ë•Œ Broadcast ë¡œì§ì´ ìˆ˜ì •ë˜ì—ˆìœ¼ë¯€ë¡œ room ì—ì„œ ë‚˜ê°€ëŠ” ë¡œì§ê³¼ broadcast ê°„ì˜ ê´€ê³„ì— ëŒ€í•´ í•™ìŠµí–ˆìŠµë‹ˆë‹¤. broadcast ì˜ ë¡œì§ì„ ì§ì ‘ ë³´ê¸° ì „ê¹Œì§€ëŠ” sender ë¥¼ ì œì™¸ì‹œí‚¤ëŠ” ê³¼ì •ì´ sender ì˜ [socket.id](http://socket.id/) ë¥¼ ì œì™¸í•˜ëŠ” ë°©ì‹ì¼ê±°ë¼ ìƒê°í–ˆëŠ”ë° ì‹¤ì œë¡œ í™•ì¸í•´ë³¸ ê²°ê³¼ [socket.id](http://socket.id/) ì™€ ê°™ì€ room (default room)ì„ ì œì™¸ì‹œí‚¤ëŠ” ë°©ì‹ì´ì—ˆìŠµë‹ˆë‹¤. default room ì„ ë‚˜ê°€ê²Œ ë˜ë©´ í•´ë‹¹ room ìì²´ê°€ ì‚¬ë¼ì ¸ë²„ë¦¬ë¯€ë¡œ sender ë¥¼ ì œì™¸ì‹œí‚¬ ìˆ˜ ì—†ëŠ” ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.


ë”°ë¼ì„œ ë§Œì•½ room ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì—°ê²°ë˜ì–´ ìˆëŠ” [socket.id](http://socket.id/) ì—ì„œ default room ê³¼ ê°™ì€ [socket.id](http://socket.id/) ê°€ ì¡´ì¬í•˜ëŠ”ì§€ì˜ ì—¬ë¶€ì— ë”°ë¼ ì œì™¸í•  ìˆ˜ ìˆë„ë¡ ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” Default Room ì„ ë©”ëª¨ë¦¬ì—ì„œ ì œê±° í•¨ìœ¼ë¡œì¨, í´ë¼ì´ì–¸íŠ¸ í•œ ëª…ì´ ì—°ê²°ë ë•Œë§ˆë‹¤ ìƒê¸°ë˜ ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ í•´ê²°&lt;/li&gt;
  &lt;li&gt;sender ë¥¼ í¬í•¨í•˜ì—¬ broadcast ë˜ë˜ ë¡œì§ì„ ìˆ˜ì •í•˜ë©´ì„œ ì§ì ‘ sender ë¥¼ ì œì™¸ì‹œì¼œì•¼ í•˜ëŠ” ì½”ë“œë¥¼ ì—†ì• ë©´ì„œ ì½”ë“œ ê°€ë…ì„± ì¦ê°€&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://socket.io/&quot;&gt;socket.io&lt;/a&gt; ì˜ ì´ìŠˆì— ì½”ë©˜íŠ¸ ë“±ë¡ ë° ì»¨íŠ¸ë¦¬ë·°ì…˜ ê°€ì´ë“œë¼ì¸ì— ë§ê²Œ &lt;a href=&quot;https://github.com/socketio/socket.io/pull/5266&quot;&gt;PR ğŸ”—&lt;/a&gt;ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;</content>

      
      
      
      
      

      <author>
          <name>[&quot;hoeeeeeh&quot;]</name>
        
        
      </author>

      

      
        <category term="chatting" />
      

      
        <summary type="html">Redis Adapter ê°€ ëª¨ë“  ë ˆë””ìŠ¤ ë…¸ë“œì— Broadcast í•˜ëŠ” ë¬¸ì œ</summary>
      

      
      
    </entry>
  
</feed>
